# Социальная сеть для путешественников

Системный дизайн социальной сети для путешественников на [курсе по системному дизайну](https://balun.courses/courses/system_design)

## Требования

### Функциональные

- Публикация поста с фотографими, описанием, с привязкой к конкретному месту путешествия
  (тэг строка)
- Оценивать посты других пользователей (лайки)
- Комментировать посты других пользователей
- Подписаться на других пользователей
- Поиск популярных мест для путешествий
- Просмотр постов с найденных мест
- Просмотр ленты других путешественников в обратном хронологическом порядке
- Просмотр ленты пользователя в обратном хронологическом порядке

### Не функциональные

- DAU 10_000_000
- Ожидаемый средний рост в год 10%
- Только страны СНГ
- Доступность в год 99.9%
- Сезонность:
  постят посты больше летом и в новогодние праздники (публикация постов) в 2-3 раза (множитель сезонности);
  поиск мест и просмотр постов весной и осенью (чтение постов, поиск постов, чтение/запись комментариев, лайки) в 2 раза
- Максимальное число подписок неограничено

- Хранение постов активных пользователей неограниченно долго
- Кол-во постов в день от пользователя 5
- Кол-во постов, которые просматривает пользователь в день 50 (включая выдачу в лентах)
- Общий максимальный размер изображений не должен превышать 1 MB
- Среднее количество изображений в посте 2
- Максимальное кол-во фотографий на один пост 10
- Максимальная длина описания поста 1 KB
- Посты появляются в ленте у подписчиков через 1 мин
- Максимальное кол-во выдачи постов в ленте пользователя за раз 10
- Максимальное кол-во выдачи постов в ленте путешественников за раз 10
- Максимальное кол-во выданных мест в поиске за раз 50

- Лайки становятся видны у других пользователей через 10 сек (какое-то время кол-во лайков может расходиться, но в итоге сходится к текущему значению)
- Кол-во реакций в день одним пользователем 50

- Комментарий под постом у других пользователей появляются через 10 сек
- Кол-во комментариев в день от пользователя 5
- Кол-во чтения комментариев в день одним пользователем 25
- Среднее количество комментариев под постом 50
- Средняя длина комментария 100 байт
- Максимальная длина комментария 1K

## Расчёт нагрузки

### Посты

Подсчёт размера сущности POST (приблизительно, так как временные метки, идентификаторы очень малы и здесь не указываются):

```
 - Максимальная длина описания поста 10KB
 - Максимальная длина тэка места - 64B

 POST_SIZE = 10000B + 64B ~= 10KB
```

Подсчёт размера сущности PHOTO

```
 - Максимальная длина URL 2000B

 PHOTO_SIZE = 2000B = 2KB
```

Подсчёт нагрузки для постов:

```
- DAU 10_000_000
- Размер сущности POST 10KB (0.10MB)
- Кол-во постов в день от пользователя 5
- Максимальный размер всех изображений 1MB

Write RPS = (10_000_000 * 5) / 86400 ~= 500
Metadata Write Traffic = 500 * 0.10MB ~= 50 MB/s
Media Write Traffic = 500 * 1MB = 500 MB/s

- DAU 10_000_000
- Кол-во постов, которые просматривает пользователь в день 50 (включая выдачу в лентах)
- Размер сущности POST 15KB (0.15MB)
- Максимальный размер всех изображений 1MB
- Среднее количество изображений в посте 2

Read RPS = (10_000_000 * 50) / 86400 ~= 5000
Metadata Read Traffic = 5000 * 0.10MB + 2 * 0.02MB ~= 750 MB/s
Media Read Traffic = 5000 * 1MB = 5 GB/s
```

### Реакции

Подсчёт размера сущности LIKE:

```
 - ID пользователя создавшего лайк - 8B
 - ID поста - 8B
 - Временная метка создания - 8B
 - Каунтер - 8B

 LIKE_SIZE = 8B + 8B + 8B + 8B = 32B
```

```
- DAU 10_000_000
- Кол-во реакций в день одним пользователем 50
- Размер сущности LIKE 32B
Write RPS = (10_000_000 * 50) / 86400 ~= 5000
Write Traffic = 5000 * 32B ~= 160KB
```

```
- DAU 10_000_000
- Кол-во постов, которые просматривает пользователь в день 50 (включая выдачу в лентах)
- Размер сущности LIKE 32B
Read RPS = (10_000_000 * 50) / 86400 ~= 5000
Read Traffic = 5000 * 32B ~= 160KB
```

### Комментарии

```
- DAU 10_000_000
- Кол-во комментариев в день от пользователя 5
- Средняя длина комментария 100 байт
Write RPS = (10_000_000 * 5) / 86400 = ~500
Write Traffic = 500 * 100B = 50K

- DAU 10_000_000
- Кол-во чтения комментариев в день одним пользователем 25 (изначально они скрыты)
- Среднее количество комментариев под постом 50
- Средняя длина комментария 100 байт
Read RPS = (10_000_000 * 25) / 86400 = ~2500
Read Traffic = 2500 * 50 * 100B ~= 13 MB/s
```
