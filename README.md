# Социальная сеть для путешественников

Системный дизайн социальной сети для путешественников на [курсе по системному дизайну](https://balun.courses/courses/system_design)

## Требования

### Функциональные

- Публикация поста с фотографими, описанием, с привязкой к конкретному месту путешествия
  (геотэг - широта, долгота)
- Оценивать посты других пользователей (лайки)
- Комментировать посты других пользователей
- Подписаться на других пользователей
- Поиск популярных мест для путешествий
- Просмотр постов с найденных мест
- Просмотр ленты других путешественников в обратном хронологическом порядке
- Просмотр ленты пользователя в обратном хронологическом порядке

### Не функциональные

- DAU 10_000_000
- Ожидаемый средний рост в год 10%
- Только страны СНГ
- Доступность в год 99.9%
- Сезонность:
  постят и комментируют посты больше летом и в новогодние праздники;
  поиск мест и просмотр постов весной и осенью
- Максимальное число подписок неограничено

- Хранение постов в течении 1 года (~365 дней) без архивации
- Кол-во постов в день от пользователя 5
- Кол-во постов, которые просматривает пользователь в день 50 (включая выдачу в лентах)
- Общий максимальный размер изображений не должен превышать 5 MB
- Среднее количество изображений в посте 2
- Максимальное кол-во фотографий на один пост 10
- Максимальная длина описания поста 10 KB
- Посты появляются в ленте у подписчиков через 1 мин
- Максимальное кол-во выдачи постов в ленте пользователя за раз 10
- Максимальное кол-во выдачи постов в ленте путешественников за раз 10
- Максимальное кол-во выданных мест в поиске за раз 50

- Лайки становятся видны у других пользователей через 10 сек (какое-то время кол-во лайков может расходиться, но в итоге сходится к текущему значению)
- Кол-во реакций в день одним пользователем 50

- Комментарий под постом у других пользователей появляются через 10 сек
- Кол-во комментариев в день от пользователя 5
- Кол-во чтения комментариев в день одним пользователем 25
- Среднее количество комментариев под постом 50
- Средняя длина комментария 100 байт
- Максимальная длина комментария 10K

## Расчёт нагрузки

### Посты

Подсчёт размера сущности POST:

```
 - Среднее количество изображений в посте 2
 - Максимальная длина URL 2000B
 - Максимальная длина описания поста 10KB
 - Геотэг (широта, долгота) - 16B
 - Кол-во лайков - 8B

 POST_SIZE = 2 * 2000B + 10240B + 8B + 16B ~= 15KB
```

Подсчёт нагрузки для постов:

```
- DAU 10_000_000
- Размер сущности POST 15KB (0.15MB)
- Максимальный размер всех изображений 5MB
- Кол-во постов в день от пользователя 5

Write RPS = (10_000_000 * 5) / 86400 ~= 500
Write Traffic = 500 * (5MB + 0.15MB) ~= 2.5 GB/s

- DAU 10_000_000
- Кол-во постов, которые просматривает пользователь в день 50 (включая выдачу в лентах)
- Максимальный размер всех изображений 5MB
- Размер сущности POST 15KB (0.15MB)

Read RPS = (10_000_000 * 50) / 86400 ~= 5000
Read Traffic = 5000 * (5MB+0.15MB) ~= 25 GB/s
```

### Реакции

```
- DAU 10_000_000
- Кол-во реакций в день одним пользователем 50
- Размер каунтера лайков, который передаётся между узлами для синхронизации 8B
Write RPS = (10_000_000 * 50) / 86400 ~= 5000
Write Traffic = 5000 * 8B ~= 40K
```

### Комментарии

```
- DAU 10_000_000
- Кол-во комментариев в день от пользователя 5
- Средняя длина комментария 100 байт
Write RPS = (10_000_000 * 5) / 86400 = ~500
Write Traffic = 500 * 100B = 50K

- DAU 10_000_000
- Кол-во чтения комментариев в день одним пользователем 25
- Среднее количество комментариев под постом 50
- Средняя длина комментария 100 байт
Read RPS = (10_000_000 * 25) / 86400 = ~2500
Read Traffic = 2500 * 50 * 100B ~= 13 MB/s
```

### Хранение

```
- DAU 10_000_000
- Хранение постов в течении 1 года (~365 дней) без архивации
- Кол-во постов в день от пользователя 5
- Размер сущности POST 15KB (0.15MB)
- Максимальный размер всех изображений 5MB
- Средняя длина комментария 100B
- Среднее количество комментариев под постом 50

365 * 10000000 * 5 * ((5MB + 0.15MB) + (100B * 50))
  ~= 3700000000 * 5 * 5MB
  ~= 18_500_000_000 * 5MB
  ~= 100_000_000_000MB ~= 100PB
```
